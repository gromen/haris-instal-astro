---
// DecapCMS Admin Panel
export const prerender = false;
---

<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="noindex" />
    <title>Panel CMS - Haris-Instal</title>
    <style>
      body { margin: 0; }
    </style>
  </head>
  <body>
    <script is:inline src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <script is:inline>
      // Config must be defined before loading CMS
      window.CMS_MANUAL_INIT = true;
    </script>
    <script is:inline src="https://unpkg.com/decap-cms@^3.1.0/dist/decap-cms.js"></script>
    <script is:inline>
      const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';

      const config = {
        backend: isLocal ? {
          name: 'test-repo'
        } : {
          name: 'git-gateway',
          branch: 'main'
        },
        locale: 'pl',
        media_folder: 'public/images/uploads',
        public_folder: '/images/uploads',
        collections: [
          {
            name: 'projekty',
            label: 'Projekty',
            label_singular: 'Projekt',
            folder: 'src/content/projekty',
            create: true,
            slug: '{{slug}}',
            fields: [
              { name: 'title', label: 'Tytuł', widget: 'string' },
              { name: 'date', label: 'Data realizacji', widget: 'datetime', format: 'YYYY-MM-DD', date_format: 'YYYY-MM-DD', time_format: false },
              { name: 'description', label: 'Krótki opis', widget: 'text', required: false },
              { name: 'thumbnail', label: 'Zdjęcie główne', widget: 'image', required: false },
              {
                name: 'gallery',
                label: 'Galeria',
                widget: 'list',
                required: false,
                field: { name: 'image', label: 'Zdjęcie', widget: 'image' }
              },
              { name: 'body', label: 'Treść', widget: 'markdown' }
            ]
          },
          {
            name: 'testimonials',
            label: 'Opinie klientów',
            label_singular: 'Opinia',
            folder: 'src/content/testimonials',
            create: true,
            slug: '{{slug}}',
            extension: 'json',
            format: 'json',
            fields: [
              { name: 'name', label: 'Imię i nazwisko', widget: 'string' },
              { name: 'location', label: 'Miejscowość', widget: 'string' },
              { name: 'text', label: 'Treść opinii', widget: 'text' },
              { name: 'rating', label: 'Ocena (1-5)', widget: 'number', min: 1, max: 5, default: 5 }
            ]
          },
          {
            name: 'faq',
            label: 'FAQ',
            label_singular: 'Pytanie',
            folder: 'src/content/faq',
            create: true,
            slug: '{{slug}}',
            extension: 'json',
            format: 'json',
            fields: [
              { name: 'question', label: 'Pytanie', widget: 'string' },
              { name: 'answer', label: 'Odpowiedź', widget: 'text' },
              { name: 'order', label: 'Kolejność', widget: 'number', default: 0 }
            ]
          }
        ]
      };

      if (isLocal) {
        config.local_backend = true;
      }

      CMS.init({ config });
    </script>
  </body>
</html>
