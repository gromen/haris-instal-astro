---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { getCollection } from 'astro:content';

const projekty = await getCollection('projekty');
const sortedProjekty = projekty.sort((a, b) =>
  new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);
---

<BaseLayout title="Projekty" description="Realizacje i projekty Haris-Instal. Zobacz nasze wykonane prace hydrauliczne." noIndex={true}>
  <Header />

  <main>
    <!-- Hero -->
    <section class="section-padding bg-[var(--bg-secondary)]">
      <div class="container-custom">
        <div class="text-center max-w-3xl mx-auto">
          <span class="text-[var(--accent)] font-medium text-sm uppercase tracking-wider">Portfolio</span>
          <h1 class="section-title mt-2">Nasze realizacje</h1>
          <p class="section-subtitle">
            Zobacz wybrane projekty, które zrealizowaliśmy dla naszych klientów.
          </p>
        </div>
      </div>
    </section>

    <!-- Projects grid -->
    <section class="section-padding">
      <div class="container-custom">
        {sortedProjekty.length > 0 ? (
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {sortedProjekty.map((projekt) => (
              <a href={`/projekty/${projekt.slug}`} class="card card-hover group overflow-hidden">
                {projekt.data.thumbnail && (
                  <div class="aspect-video mb-4 -mx-6 -mt-6 overflow-hidden">
                    <img
                      src={projekt.data.thumbnail}
                      alt={projekt.data.title}
                      class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
                      loading="lazy"
                    />
                  </div>
                )}
                <div class="flex items-center gap-2 text-sm text-[var(--text-secondary)] mb-2">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                  </svg>
                  <time datetime={projekt.data.date}>
                    {new Date(projekt.data.date).toLocaleDateString('pl-PL', {
                      year: 'numeric',
                      month: 'long',
                    })}
                  </time>
                </div>
                <h2 class="text-lg font-semibold group-hover:text-[var(--accent)] transition-colors duration-200">
                  {projekt.data.title}
                </h2>
                {projekt.data.description && (
                  <p class="text-[var(--text-secondary)] text-sm mt-2 line-clamp-2">
                    {projekt.data.description}
                  </p>
                )}
              </a>
            ))}
          </div>
        ) : (
          <div class="text-center py-16">
            <p class="text-[var(--text-secondary)]">Brak projektów do wyświetlenia.</p>
          </div>
        )}
      </div>
    </section>
  </main>

  <Footer />
</BaseLayout>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
